<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Offer Explorer — Base Power Company</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');

  :root {
    --green-100: #084D41;
    --green-90: #0a6354;
    --green-80: #0d7a68;
    --green-70: #10917c;
    --green-60: #14a890;
    --saffron: #f7c33c;
    --saffron-dark: #e0a820;
    --lime: #d0f585;
    --lime-dark: #a8d45e;
    --cream: #F0EEEB;
    --cream-dark: #e2dfdb;
    --near-black: #030303;
    --bg: #faf9f7;
    --card-bg: #ffffff;
    --card-border: rgba(8, 77, 65, 0.1);
    --card-shadow: 0 1px 3px rgba(0,0,0,0.04), 0 4px 16px rgba(8,77,65,0.06);
    --input-bg: #f5f4f2;
    --input-border: #d8d5d0;
    --text-primary: #1a1a1a;
    --text-secondary: #555550;
    --text-muted: #8a8880;
    --success: #16a34a;
    --danger: #dc2626;
    --focus-ring: rgba(8, 77, 65, 0.2);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    background: var(--bg);
    color: var(--text-primary);
    line-height: 1.6;
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
  }

  /* Top brand bar */
  .brand-bar {
    background: var(--green-100);
    padding: 14px 24px;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: 12px;
  }

  .brand-bar .logo-svg {
    height: 24px;
    width: auto;
    color: #fff;
  }

  .container {
    max-width: 880px;
    margin: 0 auto;
    padding: 0 20px 60px;
  }

  /* Tab navigation */
  .tab-nav {
    display: flex;
    gap: 0;
    margin: 24px 0 28px;
    border-bottom: 2px solid var(--cream-dark);
  }

  .tab-btn {
    padding: 12px 24px;
    font-size: 14px;
    font-weight: 600;
    color: var(--text-muted);
    background: none;
    border: none;
    cursor: pointer;
    border-bottom: 2px solid transparent;
    margin-bottom: -2px;
    transition: color 0.2s, border-color 0.2s;
    font-family: inherit;
  }

  .tab-btn:hover {
    color: var(--text-secondary);
  }

  .tab-btn.active {
    color: var(--green-100);
    border-bottom-color: var(--green-100);
  }

  .tab-panel {
    display: none;
  }

  .tab-panel.active {
    display: block;
  }

  /* Section header */
  .section-header {
    text-align: center;
    margin-bottom: 32px;
  }

  .section-header h1 {
    font-size: 28px;
    font-weight: 800;
    letter-spacing: -0.5px;
    color: var(--green-100);
    margin-bottom: 6px;
  }

  .section-header p {
    color: var(--text-secondary);
    font-size: 15px;
    max-width: 480px;
    margin: 0 auto;
  }

  /* Cards */
  .card {
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 14px;
    padding: 26px;
    margin-bottom: 18px;
    box-shadow: var(--card-shadow);
  }

  .card-title {
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1.4px;
    color: var(--green-90);
    margin-bottom: 18px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  /* Form elements */
  .form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 5px;
  }

  .form-group.full-width {
    grid-column: 1 / -1;
  }

  label {
    font-size: 13px;
    font-weight: 500;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .tooltip-trigger {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 15px;
    height: 15px;
    border-radius: 50%;
    background: rgba(8, 77, 65, 0.08);
    color: var(--green-90);
    font-size: 9px;
    font-weight: 700;
    cursor: help;
    position: relative;
    flex-shrink: 0;
  }

  .tooltip-trigger .tooltip-text {
    visibility: hidden;
    opacity: 0;
    position: absolute;
    bottom: calc(100% + 8px);
    left: 50%;
    transform: translateX(-50%);
    background: var(--green-100);
    color: #fff;
    padding: 10px 14px;
    border-radius: 8px;
    font-size: 12px;
    font-weight: 400;
    width: 240px;
    line-height: 1.5;
    z-index: 100;
    box-shadow: 0 8px 32px rgba(0,0,0,0.2);
    pointer-events: none;
    transition: opacity 0.15s, visibility 0.15s;
  }

  .tooltip-trigger .tooltip-text::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 6px solid transparent;
    border-top-color: var(--green-100);
  }

  .tooltip-trigger:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
  }

  input[type="number"], input[type="text"] {
    background: var(--input-bg);
    border: 1px solid var(--input-border);
    border-radius: 8px;
    padding: 10px 12px;
    color: var(--text-primary);
    font-size: 14px;
    font-family: inherit;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
    width: 100%;
    -moz-appearance: textfield;
  }

  input[type="number"]::-webkit-inner-spin-button,
  input[type="number"]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  input:focus {
    border-color: var(--green-80);
    box-shadow: 0 0 0 3px var(--focus-ring);
  }

  .input-prefix {
    position: relative;
  }

  .input-prefix::before {
    content: '$';
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-muted);
    font-size: 14px;
    z-index: 2;
    pointer-events: none;
  }

  .input-prefix input {
    padding-left: 24px;
  }

  /* Searchable select */
  .city-search-wrapper {
    position: relative;
  }

  .city-search-wrapper input {
    padding-right: 32px;
  }

  .city-dropdown {
    position: absolute;
    top: calc(100% + 4px);
    left: 0;
    right: 0;
    background: #fff;
    border: 1px solid var(--input-border);
    border-radius: 8px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.12);
    max-height: 220px;
    overflow-y: auto;
    z-index: 50;
    display: none;
  }

  .city-dropdown.open {
    display: block;
  }

  .city-option {
    padding: 9px 12px;
    font-size: 13px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: background 0.1s;
  }

  .city-option:hover, .city-option.highlighted {
    background: rgba(8, 77, 65, 0.06);
  }

  .city-option .city-name {
    color: var(--text-primary);
    font-weight: 500;
  }

  .city-option .city-index {
    color: var(--text-muted);
    font-size: 12px;
  }

  /* Toggle switch */
  .toggle-row {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .toggle-label {
    font-size: 13px;
    color: var(--text-muted);
    cursor: pointer;
    transition: color 0.2s;
    user-select: none;
  }

  .toggle-label.active {
    color: var(--text-primary);
    font-weight: 600;
  }

  .toggle {
    position: relative;
    width: 44px;
    height: 24px;
    flex-shrink: 0;
  }

  .toggle input {
    opacity: 0;
    width: 0;
    height: 0;
    position: absolute;
  }

  .toggle-slider {
    position: absolute;
    cursor: pointer;
    inset: 0;
    background: #ccc;
    border-radius: 24px;
    transition: background 0.25s;
  }

  .toggle-slider::before {
    content: '';
    position: absolute;
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background: #fff;
    border-radius: 50%;
    transition: transform 0.25s;
    box-shadow: 0 1px 3px rgba(0,0,0,0.15);
  }

  .toggle input:checked + .toggle-slider {
    background: var(--green-80);
  }

  .toggle input:checked + .toggle-slider::before {
    transform: translateX(20px);
  }

  .toggle-sm {
    width: 36px;
    height: 20px;
  }

  .toggle-sm .toggle-slider::before {
    height: 14px;
    width: 14px;
    left: 3px;
    bottom: 3px;
  }

  .toggle-sm input:checked + .toggle-slider::before {
    transform: translateX(16px);
  }

  /* Vesting timeline visual */
  .vesting-visual {
    margin-top: 14px;
    padding: 14px;
    background: var(--input-bg);
    border-radius: 8px;
    border: 1px solid rgba(0,0,0,0.04);
  }

  .vesting-bar-container {
    display: flex;
    gap: 3px;
    height: 28px;
    margin-bottom: 6px;
  }

  .vesting-segment {
    flex: 1;
    border-radius: 4px;
    background: var(--cream-dark);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    font-weight: 600;
    color: transparent;
    transition: background 0.3s;
  }

  .vesting-segment.cliff {
    background: repeating-linear-gradient(
      -45deg,
      var(--cream-dark),
      var(--cream-dark) 3px,
      #d0cdc8 3px,
      #d0cdc8 6px
    );
  }

  .vesting-segment.vested {
    background: linear-gradient(135deg, var(--green-80), var(--green-60));
    color: #fff;
  }

  .vesting-labels {
    display: flex;
    gap: 3px;
  }

  .vesting-labels span {
    flex: 1;
    text-align: center;
    font-size: 10px;
    color: var(--text-muted);
  }

  /* Valuation slider */
  .slider-section {
    text-align: center;
  }

  .valuation-display {
    font-size: 44px;
    font-weight: 800;
    letter-spacing: -1.5px;
    color: var(--green-100);
    margin: 6px 0 20px;
    font-variant-numeric: tabular-nums;
  }

  .slider-wrapper {
    position: relative;
    padding: 0 4px;
    margin-bottom: 8px;
  }

  input[type="range"] {
    -webkit-appearance: none;
    appearance: none;
    width: 100%;
    height: 8px;
    border-radius: 4px;
    outline: none;
    cursor: pointer;
  }

  input[type="range"]::-webkit-slider-runnable-track {
    height: 8px;
    border-radius: 4px;
    background: linear-gradient(90deg,
      var(--green-100) 0%,
      var(--green-60) 40%,
      var(--saffron) 100%
    );
  }

  input[type="range"]::-moz-range-track {
    height: 8px;
    border-radius: 4px;
    background: linear-gradient(90deg,
      var(--green-100) 0%,
      var(--green-60) 40%,
      var(--saffron) 100%
    );
  }

  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 26px;
    height: 26px;
    border-radius: 50%;
    background: #fff;
    border: 3px solid var(--green-100);
    cursor: grab;
    margin-top: -9px;
    box-shadow: 0 2px 8px rgba(8, 77, 65, 0.25);
    transition: box-shadow 0.2s, transform 0.1s;
  }

  input[type="range"]::-moz-range-thumb {
    width: 26px;
    height: 26px;
    border-radius: 50%;
    background: #fff;
    border: 3px solid var(--green-100);
    cursor: grab;
    box-shadow: 0 2px 8px rgba(8, 77, 65, 0.25);
  }

  input[type="range"]:active::-webkit-slider-thumb {
    transform: scale(1.12);
    box-shadow: 0 2px 16px rgba(8, 77, 65, 0.35);
    cursor: grabbing;
  }

  .slider-markers {
    display: flex;
    justify-content: space-between;
    padding: 8px 0 0;
  }

  .slider-marker {
    font-size: 11px;
    color: var(--text-muted);
    cursor: pointer;
    padding: 3px 6px;
    border-radius: 4px;
    transition: color 0.2s, background 0.2s;
    user-select: none;
    font-weight: 500;
  }

  .slider-marker:hover {
    color: var(--green-100);
    background: rgba(8, 77, 65, 0.06);
  }

  /* Collapsible */
  .collapsible-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    user-select: none;
    padding: 4px 0;
  }

  .collapsible-header .chevron {
    transition: transform 0.25s;
    color: var(--text-muted);
    font-size: 12px;
  }

  .collapsible-header.open .chevron {
    transform: rotate(180deg);
  }

  .collapsible-body {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease, padding 0.3s ease;
  }

  .collapsible-body.open {
    max-height: 400px;
    padding-top: 16px;
  }

  .assumption-note {
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 4px;
    font-style: italic;
  }

  /* Results */
  .results-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-bottom: 22px;
  }

  .result-item {
    background: var(--input-bg);
    border-radius: 10px;
    padding: 16px 14px;
    border: 1px solid rgba(0,0,0,0.04);
    text-align: center;
  }

  .result-label {
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    color: var(--text-muted);
    margin-bottom: 4px;
  }

  .result-value {
    font-size: 24px;
    font-weight: 700;
    letter-spacing: -0.5px;
    font-variant-numeric: tabular-nums;
    color: var(--text-primary);
  }

  .result-value.highlight {
    color: var(--green-100);
  }

  .result-value.accent {
    color: var(--green-80);
  }

  .result-sub {
    font-size: 11px;
    color: var(--text-muted);
    margin-top: 2px;
  }

  /* Vesting table */
  .vesting-table {
    width: 100%;
    border-collapse: collapse;
    margin: 0 0 24px;
    font-variant-numeric: tabular-nums;
  }

  .vesting-table th {
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    color: var(--text-muted);
    padding: 8px 10px;
    text-align: left;
    border-bottom: 2px solid var(--cream-dark);
  }

  .vesting-table td {
    padding: 9px 10px;
    font-size: 13px;
    border-bottom: 1px solid var(--cream);
    color: var(--text-secondary);
  }

  .vesting-table tr:last-child td {
    border-bottom: none;
    font-weight: 600;
    color: var(--green-100);
  }

  .vesting-table .cliff-row td {
    color: var(--text-muted);
    font-style: italic;
  }

  /* Bar chart */
  .chart-container { padding: 4px 0 0; }

  .chart-bar-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
  }

  .chart-label {
    width: 50px;
    font-size: 12px;
    font-weight: 600;
    color: var(--text-secondary);
    text-align: right;
    flex-shrink: 0;
  }

  .chart-bar-track {
    flex: 1;
    height: 30px;
    background: var(--input-bg);
    border-radius: 6px;
    overflow: hidden;
  }

  .chart-bar-fill {
    height: 100%;
    border-radius: 6px;
    transition: width 0.5s cubic-bezier(0.16, 1, 0.3, 1);
    display: flex;
    align-items: center;
    padding: 0 10px;
    font-size: 12px;
    font-weight: 600;
    color: #fff;
    white-space: nowrap;
    min-width: fit-content;
  }

  .chart-bar-fill.bar-1 { background: linear-gradient(90deg, #084D41, #0d7a68); }
  .chart-bar-fill.bar-2 { background: linear-gradient(90deg, #0a6354, #10917c); }
  .chart-bar-fill.bar-3 { background: linear-gradient(90deg, #0d7a68, #14a890); }
  .chart-bar-fill.bar-4 { background: linear-gradient(90deg, #10917c, #5ec4a8); }
  .chart-bar-fill.bar-5 { background: linear-gradient(90deg, #c5950f, #f7c33c); }
  .chart-bar-fill.bar-6 { background: linear-gradient(90deg, #a8d45e, #d0f585); }

  .chart-bar-value-external {
    font-size: 12px;
    font-weight: 600;
    color: var(--text-secondary);
    margin-left: 8px;
    flex-shrink: 0;
    min-width: 72px;
  }

  /* Tax section */
  .tax-section {
    margin-top: 18px;
    padding-top: 18px;
    border-top: 1px solid var(--cream);
  }

  .tax-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 5px 0;
    font-size: 13px;
  }

  .tax-row .tax-label { color: var(--text-secondary); }
  .tax-row .tax-value { font-weight: 600; color: var(--danger); font-variant-numeric: tabular-nums; }
  .tax-row.net .tax-label { color: var(--text-primary); font-weight: 600; }
  .tax-row.net .tax-value { color: var(--success); font-size: 15px; }

  /* ─── Cost of Living Section ─── */
  .col-hero {
    background: linear-gradient(135deg, var(--green-100) 0%, var(--green-80) 100%);
    border-radius: 14px;
    padding: 36px 28px;
    margin-bottom: 18px;
    text-align: center;
    color: #fff;
    position: relative;
    overflow: hidden;
  }

  .col-hero::before {
    content: '';
    position: absolute;
    top: -30%;
    right: -10%;
    width: 300px;
    height: 300px;
    background: radial-gradient(circle, rgba(208,245,133,0.12) 0%, transparent 70%);
    pointer-events: none;
  }

  .col-hero h2 {
    font-size: 22px;
    font-weight: 700;
    margin-bottom: 6px;
    position: relative;
  }

  .col-hero p {
    font-size: 14px;
    opacity: 0.85;
    max-width: 400px;
    margin: 0 auto;
    position: relative;
  }

  .col-inputs {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 16px;
    align-items: end;
    margin-bottom: 10px;
  }

  .col-arrow {
    display: flex;
    align-items: center;
    justify-content: center;
    padding-bottom: 10px;
    color: var(--green-80);
    font-size: 20px;
    font-weight: 700;
  }

  .col-fixed-label {
    font-size: 13px;
    font-weight: 600;
    color: var(--green-100);
    display: flex;
    align-items: center;
    gap: 6px;
    margin-bottom: 5px;
  }

  .col-fixed-city {
    background: linear-gradient(135deg, rgba(8,77,65,0.06), rgba(8,77,65,0.02));
    border: 2px solid var(--green-100);
    border-radius: 8px;
    padding: 10px 12px;
    font-size: 14px;
    font-weight: 600;
    color: var(--green-100);
  }

  /* COL Result Cards */
  .col-result-hero {
    text-align: center;
    padding: 28px 20px;
    margin-bottom: 18px;
  }

  .col-percentage {
    font-size: 56px;
    font-weight: 800;
    letter-spacing: -2px;
    line-height: 1;
    margin-bottom: 4px;
  }

  .col-percentage.cheaper {
    color: var(--success);
  }

  .col-percentage.pricier {
    color: var(--danger);
  }

  .col-direction-text {
    font-size: 15px;
    color: var(--text-secondary);
    font-weight: 500;
  }

  .col-direction-text strong {
    color: var(--green-100);
  }

  /* Salary comparison */
  .salary-compare {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
    margin-bottom: 18px;
  }

  .salary-box {
    background: var(--input-bg);
    border-radius: 10px;
    padding: 18px 16px;
    text-align: center;
    border: 1px solid rgba(0,0,0,0.04);
  }

  .salary-box.austin {
    background: linear-gradient(135deg, rgba(8,77,65,0.06), rgba(208,245,133,0.12));
    border: 1px solid rgba(8,77,65,0.15);
  }

  .salary-box-label {
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    color: var(--text-muted);
    margin-bottom: 4px;
  }

  .salary-box-value {
    font-size: 28px;
    font-weight: 700;
    letter-spacing: -0.5px;
    font-variant-numeric: tabular-nums;
    color: var(--text-primary);
  }

  .salary-box.austin .salary-box-value {
    color: var(--green-100);
  }

  .salary-box-sub {
    font-size: 11px;
    color: var(--text-muted);
    margin-top: 2px;
  }

  /* Category breakdown bars */
  .col-category-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
  }

  .col-cat-label {
    width: 100px;
    font-size: 12px;
    font-weight: 500;
    color: var(--text-secondary);
    text-align: right;
    flex-shrink: 0;
  }

  .col-cat-bar-area {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .col-cat-bar-track {
    flex: 1;
    height: 24px;
    background: var(--input-bg);
    border-radius: 4px;
    overflow: hidden;
    position: relative;
  }

  .col-cat-bar-track .baseline {
    position: absolute;
    left: 50%;
    top: 0;
    bottom: 0;
    width: 1px;
    background: var(--text-muted);
    opacity: 0.3;
  }

  .col-cat-bar-fill {
    position: absolute;
    top: 2px;
    bottom: 2px;
    border-radius: 3px;
    transition: left 0.4s, width 0.4s;
  }

  .col-cat-bar-fill.cheaper {
    background: linear-gradient(90deg, var(--green-80), var(--green-60));
  }

  .col-cat-bar-fill.pricier {
    background: linear-gradient(90deg, var(--saffron-dark), var(--saffron));
  }

  .col-cat-pct {
    width: 48px;
    font-size: 12px;
    font-weight: 600;
    flex-shrink: 0;
    text-align: left;
  }

  .col-cat-pct.cheaper { color: var(--success); }
  .col-cat-pct.pricier { color: var(--danger); }

  /* Offer input for COL */
  .offer-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
  }

  /* What your money buys */
  .purchasing-power-row {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 14px 0;
    border-bottom: 1px solid var(--cream);
  }

  .purchasing-power-row:last-child {
    border-bottom: none;
  }

  .pp-icon {
    width: 36px;
    height: 36px;
    background: rgba(8,77,65,0.07);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    flex-shrink: 0;
  }

  .pp-content {
    flex: 1;
  }

  .pp-label {
    font-size: 13px;
    font-weight: 500;
    color: var(--text-secondary);
  }

  .pp-values {
    display: flex;
    gap: 16px;
    margin-top: 2px;
  }

  .pp-val {
    font-size: 14px;
    font-weight: 600;
    font-variant-numeric: tabular-nums;
  }

  .pp-val.origin { color: var(--text-muted); text-decoration: line-through; }
  .pp-val.austin { color: var(--green-100); }

  /* Disclaimer */
  .disclaimer {
    margin-top: 32px;
    padding: 16px 20px;
    background: var(--input-bg);
    border-radius: 8px;
    font-size: 11px;
    color: var(--text-muted);
    line-height: 1.7;
  }

  /* Print button */
  .print-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    background: rgba(8, 77, 65, 0.06);
    border: 1px solid rgba(8, 77, 65, 0.15);
    border-radius: 8px;
    color: var(--green-100);
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s;
    font-family: inherit;
  }

  .print-btn:hover {
    background: rgba(8, 77, 65, 0.1);
  }

  .animating {
    transition: transform 0.15s;
    transform: scale(1.03);
  }

  .no-results {
    padding: 10px 12px;
    font-size: 13px;
    color: var(--text-muted);
    text-align: center;
  }

  /* Responsive */
  @media (max-width: 640px) {
    .container { padding: 0 14px 48px; }
    .section-header h1 { font-size: 22px; }
    .form-grid { grid-template-columns: 1fr; }
    .results-grid { grid-template-columns: 1fr; }
    .valuation-display { font-size: 34px; }
    .result-value { font-size: 20px; }
    .chart-label { width: 42px; font-size: 11px; }
    .slider-marker { font-size: 10px; padding: 3px 3px; }
    .col-inputs { grid-template-columns: 1fr; }
    .col-arrow { transform: rotate(90deg); padding: 0; }
    .salary-compare { grid-template-columns: 1fr; }
    .offer-grid { grid-template-columns: 1fr; }
    .col-cat-label { width: 72px; font-size: 11px; }
    .col-percentage { font-size: 42px; }
    .tab-btn { padding: 10px 14px; font-size: 13px; }
  }

  @media print {
    body { background: #fff; }
    .brand-bar { background: #084D41; }
    .tab-nav { display: none; }
    .tab-panel { display: block !important; page-break-inside: avoid; }
    .card { box-shadow: none; border: 1px solid #ddd; }
    input[type="range"] { display: none; }
    .slider-markers, .print-btn, .toggle, .city-dropdown { display: none; }
  }
</style>
</head>
<body>

<!-- Brand bar -->
<div class="brand-bar">
  <svg class="logo-svg" viewBox="0 0 54 20" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#bp)"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.1091 9.75295C14.7055 9.22349 15.0977 8.52569 15.0977 7.70842C15.0977 5.83223 13.6551 4.58325 11.1811 4.58325H5.15301C4.81185 4.58325 4.53516 4.86292 4.53516 5.20774V14.7896C4.53516 15.1344 4.81185 15.4141 5.15301 15.4141H11.5921C13.6417 15.4141 15.5087 14.3715 15.5087 12.2889C15.5087 11.1078 14.9795 10.2634 14.1064 9.75023L14.1091 9.75295ZM7.42024 6.77169C7.42024 6.71467 7.46591 6.66851 7.52232 6.66851H11.2321C11.8983 6.66851 12.3657 7.08393 12.3657 7.71114C12.3657 8.33834 11.952 8.75377 11.2321 8.75377H7.52232C7.46591 8.75377 7.42024 8.70761 7.42024 8.65059V6.7744V6.77169ZM11.13 13.3316H7.52232C7.46591 13.3316 7.42024 13.2854 7.42024 13.2284V10.9368C7.42024 10.8797 7.46591 10.8336 7.52232 10.8336H11.13C12.0998 10.8336 12.7794 11.2517 12.7794 12.0826C12.7794 12.9134 12.1804 13.3316 11.13 13.3316Z" fill="currentColor"/><path fill-rule="evenodd" clip-rule="evenodd" d="M26.3827 4.58325H21.1686C19.4869 4.58325 18.0175 5.72634 17.585 7.36631L15.6697 14.6294C15.5649 15.0258 15.8604 15.4168 16.2687 15.4168H17.9745C18.2539 15.4168 18.5011 15.2267 18.5709 14.9525L19.0867 12.9949C19.0974 12.9487 19.1404 12.9188 19.1861 12.9188H24.016C24.0724 12.9188 24.1181 12.965 24.1181 13.022V14.7923C24.1181 15.1371 24.3948 15.4168 24.736 15.4168H26.3853C26.7265 15.4168 27.0032 15.1371 27.0032 14.7923V5.20774C27.0032 4.86292 26.7265 4.58325 26.3853 4.58325H26.3827ZM24.1154 10.7277C24.1154 10.7847 24.0698 10.8309 24.0133 10.8309H19.7878C19.7206 10.8309 19.6696 10.7657 19.6884 10.7005L20.4271 7.9012C20.6205 7.17082 21.2733 6.66308 22.0201 6.66308H24.0133C24.0698 6.66308 24.1154 6.70924 24.1154 6.76625V10.725V10.7277Z" fill="currentColor"/><path fill-rule="evenodd" clip-rule="evenodd" d="M27.9922 12.6528C27.9922 13.3859 28.422 14.1814 29.2413 14.7136C30.0606 15.2403 30.8612 15.4141 31.8793 15.4141H34.4098C36.137 15.4141 37.1041 15.2023 37.816 14.662C38.5305 14.1162 38.8878 13.3044 38.8878 12.2971C38.8878 10.391 37.3163 9.53302 33.8295 8.86509C32.2043 8.55556 30.6892 8.41165 30.6436 7.55637C30.6167 7.07035 30.9417 6.66036 31.9142 6.66036H34.8342C35.3365 6.66036 35.6911 6.78255 35.9786 7.19797C36.0699 7.33373 36.1102 7.55909 36.1263 7.76273C36.1451 8.01795 36.3546 8.21616 36.6072 8.21616H38.1222C38.4285 8.21616 38.6756 7.96636 38.6783 7.65683C38.6783 7.57538 38.6783 7.48306 38.6783 7.3826C38.6783 6.58977 38.2162 5.78608 37.3969 5.25933C36.583 4.72716 35.3365 4.58325 34.3184 4.58325H32.4783C30.7456 4.58325 29.7651 4.83576 29.056 5.38151C28.3468 5.92455 27.9922 6.69838 27.9922 7.70842C27.9922 11.526 36.1236 10.4345 36.1236 12.4871C36.1236 13.0953 35.4762 13.3316 34.7429 13.3316H31.8121C31.0707 13.3316 30.657 12.984 30.657 12.46C30.657 12.46 30.7027 11.8246 30.0338 11.8246H28.5483C28.242 11.8246 27.9922 12.0771 27.9922 12.3867C27.9922 12.4654 27.9922 12.555 27.9922 12.6528Z" fill="currentColor"/><path fill-rule="evenodd" clip-rule="evenodd" d="M49.4663 5.20774V6.0413C49.4663 6.38613 49.1896 6.66579 48.8484 6.66579H42.9735C42.9171 6.66579 42.8714 6.71195 42.8714 6.76897V8.64516C42.8714 8.70218 42.9171 8.74834 42.9735 8.74834H48.0237C48.3649 8.74834 48.6416 9.028 48.6416 9.37283V10.2064C48.6416 10.5512 48.3649 10.8309 48.0237 10.8309H42.9735C42.9171 10.8309 42.8714 10.877 42.8714 10.9341V13.2257C42.8714 13.2827 42.9171 13.3288 42.9735 13.3288H48.8484C49.1896 13.3288 49.4663 13.6085 49.4663 13.9533V14.7869C49.4663 15.1317 49.1896 15.4114 48.8484 15.4114H40.6042C40.263 15.4114 39.9863 15.1317 39.9863 14.7869V5.20774C39.9863 4.86292 40.263 4.58325 40.6042 4.58325H48.8484C49.1896 4.58325 49.4663 4.86292 49.4663 5.20774Z" fill="currentColor"/><path d="M48.8477 0H5.15232C2.30753 0 0 2.33234 0 5.20771V14.7923C0 17.6677 2.30753 20 5.15232 20H48.8477C51.6925 20 54 17.6677 54 14.7923V5.20771C54 2.33234 51.6925 0 48.8477 0ZM51.9396 14.7923C51.9396 16.5164 50.5535 17.9175 48.8477 17.9175H5.15232C3.44384 17.9175 2.06039 16.5191 2.06039 14.7923V5.20771C2.06039 3.48086 3.44384 2.08254 5.15232 2.08254H48.8477C50.5535 2.08254 51.9396 3.48357 51.9396 5.20771V14.7896V14.7923Z" fill="currentColor"/></g><defs><clipPath id="bp"><rect width="54" height="20" fill="currentColor"/></clipPath></defs></svg>
</div>

<div class="container">

  <!-- Tab navigation -->
  <div class="tab-nav">
    <button class="tab-btn active" onclick="switchTab('equity')">Equity Value Explorer</button>
    <button class="tab-btn" onclick="switchTab('col')">Cost of Living Calculator</button>
  </div>

  <!-- ═══════════════════════════════════════ -->
  <!-- TAB 1: EQUITY VALUE EXPLORER            -->
  <!-- ═══════════════════════════════════════ -->
  <div class="tab-panel active" id="panel-equity">
    <div class="section-header">
      <h1>Equity Value Explorer</h1>
      <p>Enter your offer details to see your total compensation across different company valuations.</p>
    </div>

    <!-- Offer Inputs -->
    <div class="card">
      <div class="card-title">Your Offer Details</div>
      <div class="form-grid">
        <div class="form-group">
          <label>Base Salary
            <span class="tooltip-trigger">?<span class="tooltip-text">Your annual base salary from your offer letter.</span></span>
          </label>
          <div class="input-prefix">
            <input type="text" id="baseSalary" value="150,000" oninput="handleSalaryInput(this)" inputmode="numeric">
          </div>
        </div>
        <div class="form-group">
          <label>RSU Grant Value
            <span class="tooltip-trigger">?<span class="tooltip-text">The total dollar value of RSUs in your offer letter.</span></span>
          </label>
          <div class="input-prefix">
            <input type="text" id="rsuDollar" value="50,000" oninput="handleRsuDollarInput(this)" inputmode="numeric">
          </div>
        </div>
        <div class="form-group">
          <label>Grant-Time Valuation
            <span class="tooltip-trigger">?<span class="tooltip-text">The company's valuation when your RSUs were granted. This determines how your equity grows as the company valuation increases.</span></span>
          </label>
          <select id="grantValuation" onchange="recalculate()" style="width:100%;padding:10px 12px;border:1px solid var(--input-border);border-radius:8px;background:var(--input-bg);font-size:14px;font-family:inherit;color:var(--text-primary);cursor:pointer;">
            <option value="1">$1B</option>
            <option value="2">$2B</option>
            <option value="4" selected>$4B</option>
            <option value="5">$5B</option>
            <option value="10">$10B</option>
          </select>
        </div>
        <div class="form-group full-width">
          <div style="display:flex;gap:24px;font-size:13px;color:var(--text-secondary);">
            <span><strong>Vesting:</strong> 5 years</span>
            <span><strong>Cliff:</strong> 1 year</span>
          </div>
          <div class="vesting-visual" style="margin-top:8px;">
            <div class="vesting-bar-container" id="vestingBarContainer"></div>
            <div class="vesting-labels" id="vestingLabels"></div>
          </div>
        </div>
      </div>
    </div>
    <input type="hidden" id="vestingYears" value="5">
    <input type="hidden" id="cliffYears" value="1">

    <!-- Valuation Slider -->
    <div class="card slider-section">
      <div class="card-title">What could your equity be worth?</div>
      <p style="font-size:13px;color:var(--text-secondary);margin-bottom:16px;">Drag the slider to see how your RSU grant grows at different company valuations.</p>
      <div class="valuation-display" id="valuationDisplay">$4B</div>
      <div class="slider-wrapper">
        <input type="range" id="valuationSlider" min="0" max="5" value="1" step="1" oninput="handleValuationSlider()">
      </div>
      <div class="slider-markers">
        <span class="slider-marker" onclick="setValuationStep(0)">$1B</span>
        <span class="slider-marker" onclick="setValuationStep(1)">$4B</span>
        <span class="slider-marker" onclick="setValuationStep(2)">$10B</span>
        <span class="slider-marker" onclick="setValuationStep(3)">$25B</span>
        <span class="slider-marker" onclick="setValuationStep(4)">$50B</span>
        <span class="slider-marker" onclick="setValuationStep(5)">$100B</span>
      </div>
    </div>

    <!-- Equity Value Results -->
    <div class="card">
      <div class="card-title">Your Equity Potential</div>
      <div style="text-align:center;padding:8px 0 16px;">
        <div class="result-label" style="margin-bottom:4px;">Projected RSU Value (Fully Vested)</div>
        <div class="result-value highlight" id="equityHeroValue" style="font-size:40px;">$0</div>
        <div class="result-sub" id="equityHeroSub" style="margin-top:4px;font-size:13px;">Your $50,000 grant could be worth this at the selected valuation</div>
      </div>
      <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:16px;padding-top:16px;border-top:1px solid var(--cream-dark);">
        <div class="result-item" style="text-align:center;">
          <div class="result-label">RSU Grant</div>
          <div class="result-value accent" id="rsuGrantValue">$50,000</div>
          <div class="result-sub" id="rsuGrantSub">granted at $4B valuation</div>
        </div>
        <div class="result-item" style="text-align:center;">
          <div class="result-label">Growth Multiple</div>
          <div class="result-value accent" id="equityMultiple">1.0x</div>
          <div class="result-sub" id="equityMultipleSub">return on grant value</div>
        </div>
      </div>
      <div style="overflow-x:auto;">
        <table class="vesting-table">
          <thead><tr><th>Year</th><th>% Vested</th><th>Value</th></tr></thead>
          <tbody id="vestingTableBody"></tbody>
        </table>
      </div>
      <div class="tax-section" id="taxSection" style="display:none;">
        <div style="margin-bottom:8px;">
          <label style="font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:0.8px;color:var(--text-muted);">Estimated Tax Impact (fully vested)</label>
        </div>
        <div class="tax-row">
          <span class="tax-label">Federal Tax (~24%)</span>
          <span class="tax-value" id="federalTax">-$0</span>
        </div>
        <div class="tax-row">
          <span class="tax-label">State Tax (~5%)</span>
          <span class="tax-value" id="stateTax">-$0</span>
        </div>
        <div class="tax-row net">
          <span class="tax-label">After-Tax Value</span>
          <span class="tax-value" id="afterTaxValue">$0</span>
        </div>
      </div>
      <div style="display:flex;align-items:center;gap:10px;margin-top:12px;">
        <div class="toggle-row">
          <label style="font-size:12px;color:var(--text-muted);">Show Tax Estimate</label>
          <label class="toggle toggle-sm">
            <input type="checkbox" id="taxToggle" onchange="toggleTax()">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    </div>

    <!-- Total Comp Summary -->
    <div class="card" style="background:var(--cream);border:1px solid var(--cream-dark);">
      <div class="card-title" style="font-size:13px;text-transform:uppercase;letter-spacing:0.6px;">Total Annual Compensation</div>
      <div style="display:grid;grid-template-columns:1fr auto 1fr auto 1fr;align-items:center;gap:8px;text-align:center;">
        <div>
          <div style="font-size:12px;color:var(--text-muted);margin-bottom:2px;">Base Salary</div>
          <div style="font-size:20px;font-weight:700;color:var(--text-primary);" id="baseSalaryDisplay">$150,000</div>
        </div>
        <div style="font-size:18px;color:var(--text-muted);font-weight:300;">+</div>
        <div>
          <div style="font-size:12px;color:var(--text-muted);margin-bottom:2px;">Annual RSU Vest</div>
          <div style="font-size:20px;font-weight:700;color:var(--green-100);" id="annualVestValue">$0</div>
        </div>
        <div style="font-size:18px;color:var(--text-muted);font-weight:300;">=</div>
        <div>
          <div style="font-size:12px;color:var(--text-muted);margin-bottom:2px;">Total Comp/Year</div>
          <div style="font-size:22px;font-weight:800;color:var(--green-100);" id="totalCompValue">$0</div>
        </div>
      </div>
      <div id="totalCompSub" style="text-align:center;font-size:11px;color:var(--text-muted);margin-top:8px;">at current slider valuation</div>
      <div id="annualVestSub" style="display:none;"></div>
    </div>

    <!-- Comparison Chart -->
    <div class="card">
      <div class="card-title">Equity Value by Company Valuation</div>
      <div class="chart-container" id="comparisonChart"></div>
    </div>

    <div style="text-align:center;">
      <button class="print-btn" onclick="window.print()">Print / Save for Reference</button>
    </div>

    <div class="disclaimer">
      <strong>Disclaimer:</strong> This tool is for illustrative purposes only. Actual equity value depends on many factors including share class, liquidation preferences, dilution, and future financing. Consult your offer letter and ask your recruiter for details.
    </div>
  </div>

  <!-- ═══════════════════════════════════════ -->
  <!-- TAB 2: COST OF LIVING CALCULATOR        -->
  <!-- ═══════════════════════════════════════ -->
  <div class="tab-panel" id="panel-col">

    <div class="col-hero">
      <h2>Your Dollar Goes Further in Austin</h2>
      <p>See how your offer's purchasing power compares when you move to Austin, TX.</p>
    </div>

    <!-- Location Inputs -->
    <div class="card">
      <div class="card-title">Compare Locations</div>
      <div class="col-inputs">
        <div class="form-group">
          <label>Moving From</label>
          <div class="city-search-wrapper">
            <input type="text" id="colCitySearch" placeholder="Type a city..." oninput="handleCitySearch(this.value)" onfocus="handleCitySearch(this.value)" autocomplete="off">
            <div class="city-dropdown" id="colCityDropdown"></div>
          </div>
        </div>
        <div class="col-arrow">&#8594;</div>
        <div class="form-group">
          <div class="col-fixed-label">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M7 0.5L8.7 5.3L13.5 5.3L9.6 8.2L11.1 13L7 10.1L2.9 13L4.4 8.2L0.5 5.3L5.3 5.3L7 0.5Z" fill="#084D41"/></svg>
            Moving To
          </div>
          <div class="col-fixed-city">Austin, TX</div>
        </div>
      </div>
    </div>

    <!-- Main COL Result -->
    <div class="card col-result-hero" id="colResultCard" style="display:none;">
      <div class="col-percentage" id="colPercentage">-15%</div>
      <div class="col-direction-text" id="colDirectionText">Austin is <strong>15% cheaper</strong> than San Francisco, CA</div>
    </div>

    <!-- Offer Details -->
    <div class="card" id="colOfferCard" style="display:none;">
      <div class="card-title">Your Offer</div>
      <div class="offer-grid">
        <div class="form-group">
          <label>Base Salary
            <span class="tooltip-trigger">?<span class="tooltip-text">Your annual base salary from your offer letter. This is used to calculate equivalent purchasing power.</span></span>
          </label>
          <div class="input-prefix">
            <input type="text" id="colSalary" value="150,000" oninput="handleColSalaryInput(this)" inputmode="numeric">
          </div>
        </div>
        <div class="form-group">
          <label>Annual Bonus (if any)</label>
          <div class="input-prefix">
            <input type="text" id="colBonus" value="0" oninput="handleColBonusInput(this)" inputmode="numeric">
          </div>
        </div>
      </div>
    </div>

    <!-- Salary Comparison -->
    <div class="card" id="colSalaryCard" style="display:none;">
      <div class="card-title">Purchasing Power Comparison</div>
      <div class="salary-compare">
        <div class="salary-box">
          <div class="salary-box-label" id="colOriginLabel">San Francisco</div>
          <div class="salary-box-value" id="colOriginSalary">$150,000</div>
          <div class="salary-box-sub">feels like at your current city</div>
        </div>
        <div class="salary-box austin">
          <div class="salary-box-label">Austin, TX</div>
          <div class="salary-box-value" id="colAustinEquiv">$176,471</div>
          <div class="salary-box-sub">equivalent purchasing power</div>
        </div>
      </div>

      <!-- What your money buys -->
      <div style="margin-top:8px;">
        <div class="purchasing-power-row">
          <div class="pp-icon">&#127968;</div>
          <div class="pp-content">
            <div class="pp-label">Monthly Rent (1BR)</div>
            <div class="pp-values">
              <div class="pp-val origin" id="ppRentOrigin">$3,200</div>
              <div class="pp-val austin" id="ppRentAustin">$1,650</div>
            </div>
          </div>
        </div>
        <div class="purchasing-power-row">
          <div class="pp-icon">&#127869;</div>
          <div class="pp-content">
            <div class="pp-label">Monthly Groceries (1 person)</div>
            <div class="pp-values">
              <div class="pp-val origin" id="ppFoodOrigin">$520</div>
              <div class="pp-val austin" id="ppFoodAustin">$380</div>
            </div>
          </div>
        </div>
        <div class="purchasing-power-row">
          <div class="pp-icon">&#9981;</div>
          <div class="pp-content">
            <div class="pp-label">Monthly Utilities</div>
            <div class="pp-values">
              <div class="pp-val origin" id="ppUtilOrigin">$180</div>
              <div class="pp-val austin" id="ppUtilAustin">$155</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Category Breakdown -->
    <div class="card" id="colCategoryCard" style="display:none;">
      <div class="card-title">Category Breakdown</div>
      <div id="colCategoryBars"></div>
      <div style="text-align:center;margin-top:8px;">
        <span style="font-size:10px;color:var(--text-muted);">&#9664; Austin cheaper&nbsp;&nbsp;|&nbsp;&nbsp;Austin pricier &#9654;</span>
      </div>
    </div>

    <!-- No state income tax callout -->
    <div class="card" id="colTaxCard" style="display:none;">
      <div class="card-title">Texas Tax Advantage</div>
      <div style="display:flex;align-items:flex-start;gap:14px;">
        <div style="font-size:28px;flex-shrink:0;">&#127881;</div>
        <div>
          <div style="font-size:15px;font-weight:600;color:var(--green-100);margin-bottom:4px;">No state income tax in Texas</div>
          <div style="font-size:13px;color:var(--text-secondary);line-height:1.6;" id="colTaxSavingsText">
            Moving from California (13.3% top rate), you could save an estimated <strong>$19,950</strong> per year on state income taxes alone on a $150K salary.
          </div>
        </div>
      </div>
    </div>

    <div style="text-align:center;">
      <button class="print-btn" onclick="window.print()">Print / Save for Reference</button>
    </div>

    <div class="disclaimer">
      <strong>Disclaimer:</strong> Cost of living data is approximate and based on aggregate index data. Actual costs vary by neighborhood, lifestyle, and personal spending. Tax information is general and not financial advice. Consult a tax professional for your specific situation.
    </div>
  </div>

</div>

<script>
// ═══════════════════════════════════════════════════════════
// TAB SWITCHING
// ═══════════════════════════════════════════════════════════
function switchTab(tab) {
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  if (tab === 'equity') {
    document.querySelectorAll('.tab-btn')[0].classList.add('active');
    document.getElementById('panel-equity').classList.add('active');
  } else {
    document.querySelectorAll('.tab-btn')[1].classList.add('active');
    document.getElementById('panel-col').classList.add('active');
  }
}

// ═══════════════════════════════════════════════════════════
// EQUITY VALUE EXPLORER
// ═══════════════════════════════════════════════════════════

const VALUATION_STEPS = [1, 4, 10, 25, 50, 100];

let eqState = {
  baseSalary: 150000,
  rsuDollar: 50000,
  grantValuationB: 4,
  vestingYears: 5,
  cliffYears: 1,
  valuationB: 4,
  showTax: false,
};

function fmt(n) {
  if (n >= 1e9) return '$' + (n / 1e9).toFixed(1).replace(/\.0$/, '') + 'B';
  if (n >= 1e6) return '$' + (n / 1e6).toFixed(1).replace(/\.0$/, '') + 'M';
  if (n >= 1e4) return '$' + Math.round(n).toLocaleString('en-US');
  if (n >= 100) return '$' + Math.round(n).toLocaleString('en-US');
  if (n >= 1) return '$' + n.toFixed(2);
  if (n >= 0.01) return '$' + n.toFixed(2);
  if (n > 0) return '$' + n.toFixed(4);
  return '$0';
}

function fmtCompact(n) {
  if (n >= 1e9) return '$' + (n / 1e9).toFixed(1).replace(/\.0$/, '') + 'B';
  if (n >= 1e6) return '$' + (n / 1e6).toFixed(1).replace(/\.0$/, '') + 'M';
  if (n >= 1e3) return '$' + (n / 1e3).toFixed(0) + 'K';
  return '$' + Math.round(n).toLocaleString('en-US');
}

function fmtDollar(n) {
  if (Math.abs(n) >= 1e3) return '$' + Math.round(n).toLocaleString('en-US');
  if (Math.abs(n) >= 1) return '$' + n.toFixed(2);
  if (Math.abs(n) > 0) return '$' + n.toFixed(4);
  return '$0';
}

function formatWithCommas(n) { return n.toLocaleString('en-US'); }

function handleRsuDollarInput(el) {
  const raw = el.value.replace(/[^0-9]/g, '');
  const num = parseInt(raw, 10) || 0;
  const pos = el.selectionStart;
  const oldLen = el.value.length;
  el.value = num > 0 ? formatWithCommas(num) : '';
  el.setSelectionRange(Math.max(0, pos + (el.value.length - oldLen)), Math.max(0, pos + (el.value.length - oldLen)));
  eqState.rsuDollar = num;
  recalculate();
}

function handleSalaryInput(el) {
  const raw = el.value.replace(/[^0-9]/g, '');
  const num = parseInt(raw, 10) || 0;
  const pos = el.selectionStart;
  const oldLen = el.value.length;
  el.value = num > 0 ? formatWithCommas(num) : '';
  el.setSelectionRange(Math.max(0, pos + (el.value.length - oldLen)), Math.max(0, pos + (el.value.length - oldLen)));
  eqState.baseSalary = num;
  recalculate();
}

function handleValuationSlider() {
  const step = parseInt(document.getElementById('valuationSlider').value);
  eqState.valuationB = VALUATION_STEPS[step];
  recalculate();
}

function setValuationStep(step) {
  document.getElementById('valuationSlider').value = step;
  eqState.valuationB = VALUATION_STEPS[step];
  recalculate();
}

function toggleTax() {
  eqState.showTax = document.getElementById('taxToggle').checked;
  document.getElementById('taxSection').style.display = eqState.showTax ? 'block' : 'none';
  recalculate();
}

function calcEquityValue(valuationB) {
  const multiple = eqState.grantValuationB > 0 ? valuationB / eqState.grantValuationB : 0;
  const totalValue = eqState.rsuDollar * multiple;
  return { totalValue: totalValue, multiple: multiple };
}

let animFrames = {};
function animateValue(el, text) {
  el.textContent = text;
  el.classList.add('animating');
  clearTimeout(animFrames[el.id]);
  animFrames[el.id] = setTimeout(() => el.classList.remove('animating'), 150);
}

function recalculate() {
  const step = parseInt(document.getElementById('valuationSlider').value);
  eqState.valuationB = VALUATION_STEPS[step] || 4;
  eqState.grantValuationB = parseFloat(document.getElementById('grantValuation').value) || 4;

  const v = eqState.valuationB;
  const { totalValue, multiple } = calcEquityValue(v);
  const annualVest = totalValue / eqState.vestingYears;
  const totalComp = eqState.baseSalary + annualVest;

  const valDisplay = document.getElementById('valuationDisplay');
  valDisplay.textContent = v >= 10 ? `$${Math.round(v)}B` : `$${v.toFixed(1).replace(/\.0$/, '')}B`;

  // Equity hero
  animateValue(document.getElementById('equityHeroValue'), fmt(totalValue));
  document.getElementById('equityHeroSub').textContent =
    `Your ${fmt(eqState.rsuDollar)} grant could be worth this at a $${v >= 10 ? Math.round(v) : v}B valuation`;

  // Equity details
  animateValue(document.getElementById('rsuGrantValue'), fmt(eqState.rsuDollar));
  document.getElementById('rsuGrantSub').textContent = `granted at $${eqState.grantValuationB}B valuation`;
  animateValue(document.getElementById('equityMultiple'), multiple >= 10 ? Math.round(multiple) + 'x' : multiple.toFixed(1) + 'x');
  document.getElementById('equityMultipleSub').textContent = multiple >= 2 ? `${fmt(totalValue - eqState.rsuDollar)} gain on grant` : 'return on grant value';

  // Total comp summary
  animateValue(document.getElementById('baseSalaryDisplay'), fmt(eqState.baseSalary));
  animateValue(document.getElementById('annualVestValue'), fmt(annualVest));
  animateValue(document.getElementById('totalCompValue'), fmt(totalComp));
  document.getElementById('totalCompSub').textContent = `at $${v >= 10 ? Math.round(v) : v}B valuation · ${fmt(totalValue)} fully vested over 5 yrs`;

  renderVestingTable(totalValue);
  renderVestingBar();
  renderComparisonChart();

  if (eqState.showTax) {
    const gain = Math.max(0, totalValue);
    const fed = gain * 0.24;
    const st = gain * 0.05;
    document.getElementById('federalTax').textContent = '-' + fmt(fed);
    document.getElementById('stateTax').textContent = '-' + fmt(st);
    document.getElementById('afterTaxValue').textContent = fmt(gain - fed - st);
  }
}

function renderVestingBar() {
  const c = document.getElementById('vestingBarContainer');
  const l = document.getElementById('vestingLabels');
  let s = '', lb = '';
  for (let y = 0; y < eqState.vestingYears; y++) {
    const isCliff = y < eqState.cliffYears;
    const pct = !isCliff ? Math.round(((y + 1) / eqState.vestingYears) * 100) : 0;
    s += `<div class="vesting-segment ${isCliff ? 'cliff' : 'vested'}">${!isCliff ? pct + '%' : ''}</div>`;
    lb += `<span>Yr ${y + 1}</span>`;
  }
  c.innerHTML = s;
  l.innerHTML = lb;
}

function renderVestingTable(totalValue) {
  const tbody = document.getElementById('vestingTableBody');
  let rows = '';
  for (let y = 0; y <= eqState.vestingYears; y++) {
    if (y === 0) { rows += `<tr class="cliff-row"><td>Year 0</td><td>0%</td><td>$0</td></tr>`; continue; }
    if (y < eqState.cliffYears) { rows += `<tr class="cliff-row"><td>Year ${y}</td><td>0%</td><td>$0 (cliff)</td></tr>`; continue; }
    const pct = y / eqState.vestingYears;
    const val = totalValue * pct;
    const last = y === eqState.vestingYears;
    rows += `<tr><td>Year ${y}${last ? ' (fully vested)' : ''}</td><td>${Math.round(pct * 100)}%</td><td>${fmt(val)}</td></tr>`;
  }
  tbody.innerHTML = rows;
}

function renderComparisonChart() {
  const ms = VALUATION_STEPS;
  const vals = ms.map(v => calcEquityValue(v).totalValue);
  const max = Math.max(...vals, 1);
  const c = document.getElementById('comparisonChart');
  let h = '';
  ms.forEach((m, i) => {
    const w = Math.max(2, (vals[i] / max) * 100);
    const txt = fmtCompact(vals[i]);
    const small = w < 25;
    h += `<div class="chart-bar-row"><div class="chart-label">$${m}B</div><div class="chart-bar-track"><div class="chart-bar-fill bar-${i + 1}" style="width:${w}%;">${!small ? txt : ''}</div></div>${small ? `<div class="chart-bar-value-external">${txt}</div>` : '<div class="chart-bar-value-external"></div>'}</div>`;
  });
  c.innerHTML = h;
}

// ═══════════════════════════════════════════════════════════
// COST OF LIVING CALCULATOR
// ═══════════════════════════════════════════════════════════

// COL indices relative to national average = 100
// Sources: BestPlaces, Numbeo, C2ER aggregate data
const CITIES = [
  { name: "San Francisco, CA", overall: 178, housing: 334, grocery: 110, utilities: 97, transport: 130, healthcare: 112, stateIncomeTax: 13.3 },
  { name: "New York, NY", overall: 187, housing: 348, grocery: 117, utilities: 107, transport: 120, healthcare: 110, stateIncomeTax: 10.9 },
  { name: "Manhattan, NY", overall: 235, housing: 500, grocery: 125, utilities: 112, transport: 95, healthcare: 115, stateIncomeTax: 10.9 },
  { name: "Brooklyn, NY", overall: 192, housing: 360, grocery: 118, utilities: 108, transport: 95, healthcare: 112, stateIncomeTax: 10.9 },
  { name: "Los Angeles, CA", overall: 166, housing: 290, grocery: 108, utilities: 100, transport: 133, healthcare: 107, stateIncomeTax: 13.3 },
  { name: "San Diego, CA", overall: 160, housing: 272, grocery: 106, utilities: 108, transport: 118, healthcare: 109, stateIncomeTax: 13.3 },
  { name: "San Jose, CA", overall: 182, housing: 340, grocery: 112, utilities: 103, transport: 118, healthcare: 109, stateIncomeTax: 13.3 },
  { name: "Seattle, WA", overall: 157, housing: 264, grocery: 110, utilities: 92, transport: 122, healthcare: 115, stateIncomeTax: 0 },
  { name: "Boston, MA", overall: 152, housing: 249, grocery: 109, utilities: 115, transport: 115, healthcare: 118, stateIncomeTax: 5.0 },
  { name: "Washington, DC", overall: 152, housing: 260, grocery: 107, utilities: 107, transport: 115, healthcare: 104, stateIncomeTax: 10.75 },
  { name: "Denver, CO", overall: 129, housing: 176, grocery: 103, utilities: 93, transport: 105, healthcare: 108, stateIncomeTax: 4.4 },
  { name: "Chicago, IL", overall: 107, housing: 108, grocery: 103, utilities: 96, transport: 112, healthcare: 104, stateIncomeTax: 4.95 },
  { name: "Miami, FL", overall: 131, housing: 176, grocery: 107, utilities: 99, transport: 111, healthcare: 108, stateIncomeTax: 0 },
  { name: "Portland, OR", overall: 130, housing: 176, grocery: 104, utilities: 88, transport: 115, healthcare: 112, stateIncomeTax: 9.9 },
  { name: "Minneapolis, MN", overall: 109, housing: 120, grocery: 100, utilities: 95, transport: 107, healthcare: 104, stateIncomeTax: 9.85 },
  { name: "Atlanta, GA", overall: 109, housing: 121, grocery: 102, utilities: 98, transport: 110, healthcare: 103, stateIncomeTax: 5.49 },
  { name: "Nashville, TN", overall: 106, housing: 113, grocery: 97, utilities: 96, transport: 100, healthcare: 105, stateIncomeTax: 0 },
  { name: "Raleigh, NC", overall: 102, housing: 107, grocery: 97, utilities: 94, transport: 98, healthcare: 106, stateIncomeTax: 4.5 },
  { name: "Salt Lake City, UT", overall: 107, housing: 122, grocery: 98, utilities: 87, transport: 102, healthcare: 102, stateIncomeTax: 4.65 },
  { name: "Philadelphia, PA", overall: 117, housing: 141, grocery: 107, utilities: 106, transport: 110, healthcare: 105, stateIncomeTax: 3.07 },
  { name: "Pittsburgh, PA", overall: 93, housing: 77, grocery: 101, utilities: 103, transport: 102, healthcare: 99, stateIncomeTax: 3.07 },
  { name: "Detroit, MI", overall: 88, housing: 62, grocery: 95, utilities: 102, transport: 110, healthcare: 100, stateIncomeTax: 4.25 },
  { name: "Houston, TX", overall: 96, housing: 85, grocery: 96, utilities: 103, transport: 102, healthcare: 96, stateIncomeTax: 0 },
  { name: "Dallas, TX", overall: 102, housing: 99, grocery: 97, utilities: 105, transport: 103, healthcare: 101, stateIncomeTax: 0 },
  { name: "Phoenix, AZ", overall: 103, housing: 107, grocery: 97, utilities: 100, transport: 99, healthcare: 100, stateIncomeTax: 2.5 },
  { name: "Columbus, OH", overall: 93, housing: 80, grocery: 98, utilities: 90, transport: 98, healthcare: 100, stateIncomeTax: 3.75 },
  { name: "Charlotte, NC", overall: 100, housing: 100, grocery: 99, utilities: 96, transport: 98, healthcare: 106, stateIncomeTax: 4.5 },
  { name: "Indianapolis, IN", overall: 90, housing: 71, grocery: 97, utilities: 94, transport: 100, healthcare: 100, stateIncomeTax: 3.05 },
  { name: "Kansas City, MO", overall: 91, housing: 73, grocery: 97, utilities: 104, transport: 98, healthcare: 99, stateIncomeTax: 4.8 },
  { name: "Tampa, FL", overall: 103, housing: 107, grocery: 103, utilities: 99, transport: 100, healthcare: 100, stateIncomeTax: 0 },
  { name: "Sacramento, CA", overall: 137, housing: 196, grocery: 105, utilities: 99, transport: 115, healthcare: 105, stateIncomeTax: 13.3 },
  { name: "Oakland, CA", overall: 168, housing: 302, grocery: 112, utilities: 100, transport: 120, healthcare: 110, stateIncomeTax: 13.3 },
  { name: "Baltimore, MD", overall: 108, housing: 117, grocery: 103, utilities: 107, transport: 108, healthcare: 100, stateIncomeTax: 5.75 },
];

const AUSTIN = { name: "Austin, TX", overall: 111, housing: 131, grocery: 97, utilities: 99, transport: 100, healthcare: 98, stateIncomeTax: 0 };

// Austin baseline costs (monthly)
const AUSTIN_COSTS = { rent: 1650, grocery: 380, utilities: 155 };

let colState = { selectedCity: null, salary: 150000, bonus: 0 };

function handleCitySearch(query) {
  const dd = document.getElementById('colCityDropdown');
  if (!query || query.length < 1) { dd.classList.remove('open'); return; }
  const q = query.toLowerCase();
  const matches = CITIES.filter(c => c.name.toLowerCase().includes(q)).slice(0, 8);
  if (matches.length === 0) {
    dd.innerHTML = '<div class="no-results">No matching city found</div>';
    dd.classList.add('open');
    return;
  }
  dd.innerHTML = matches.map(c => {
    const diff = ((c.overall - AUSTIN.overall) / AUSTIN.overall * 100);
    const diffStr = diff > 0 ? `+${diff.toFixed(0)}% vs Austin` : `${diff.toFixed(0)}% vs Austin`;
    return `<div class="city-option" onclick="selectCity('${c.name}')"><span class="city-name">${c.name}</span><span class="city-index">${diffStr}</span></div>`;
  }).join('');
  dd.classList.add('open');
}

function selectCity(name) {
  const city = CITIES.find(c => c.name === name);
  if (!city) return;
  colState.selectedCity = city;
  document.getElementById('colCitySearch').value = city.name;
  document.getElementById('colCityDropdown').classList.remove('open');
  showColResults();
  recalculateCOL();
}

function showColResults() {
  ['colResultCard', 'colOfferCard', 'colSalaryCard', 'colCategoryCard', 'colTaxCard'].forEach(id => {
    document.getElementById(id).style.display = '';
  });
}

function handleColSalaryInput(el) {
  const raw = el.value.replace(/[^0-9]/g, '');
  const num = parseInt(raw, 10) || 0;
  const pos = el.selectionStart;
  const oldLen = el.value.length;
  el.value = num > 0 ? formatWithCommas(num) : '';
  el.setSelectionRange(Math.max(0, pos + (el.value.length - oldLen)), Math.max(0, pos + (el.value.length - oldLen)));
  colState.salary = num;
  recalculateCOL();
}

function handleColBonusInput(el) {
  const raw = el.value.replace(/[^0-9]/g, '');
  const num = parseInt(raw, 10) || 0;
  const pos = el.selectionStart;
  const oldLen = el.value.length;
  el.value = num > 0 ? formatWithCommas(num) : '';
  el.setSelectionRange(Math.max(0, pos + (el.value.length - oldLen)), Math.max(0, pos + (el.value.length - oldLen)));
  colState.bonus = num;
  recalculateCOL();
}

function recalculateCOL() {
  const city = colState.selectedCity;
  if (!city) return;
  const totalComp = colState.salary + colState.bonus;

  // Overall difference
  const diffPct = ((city.overall - AUSTIN.overall) / city.overall * 100);
  const isCheaper = diffPct > 0;

  // Percentage display
  const pctEl = document.getElementById('colPercentage');
  pctEl.textContent = `${Math.abs(diffPct).toFixed(0)}%`;
  pctEl.className = 'col-percentage ' + (isCheaper ? 'cheaper' : 'pricier');

  const dirEl = document.getElementById('colDirectionText');
  if (isCheaper) {
    dirEl.innerHTML = `Austin is <strong>${Math.abs(diffPct).toFixed(0)}% more affordable</strong> than ${city.name}`;
  } else {
    dirEl.innerHTML = `Austin is <strong>${Math.abs(diffPct).toFixed(0)}% more expensive</strong> than ${city.name}`;
  }

  // Salary purchasing power: salary in city X buys as much as (salary * city.overall / austin.overall) in Austin
  const equivalentInAustin = Math.round(totalComp * (city.overall / AUSTIN.overall));
  document.getElementById('colOriginLabel').textContent = city.name.split(',')[0];
  document.getElementById('colOriginSalary').textContent = '$' + formatWithCommas(totalComp);
  document.getElementById('colAustinEquiv').textContent = '$' + formatWithCommas(equivalentInAustin);

  // Monthly cost estimates
  const rentRatio = city.housing / AUSTIN.housing;
  const foodRatio = city.grocery / AUSTIN.grocery;
  const utilRatio = city.utilities / AUSTIN.utilities;

  document.getElementById('ppRentOrigin').textContent = '$' + formatWithCommas(Math.round(AUSTIN_COSTS.rent * rentRatio));
  document.getElementById('ppRentAustin').textContent = '$' + formatWithCommas(AUSTIN_COSTS.rent);
  document.getElementById('ppFoodOrigin').textContent = '$' + formatWithCommas(Math.round(AUSTIN_COSTS.grocery * foodRatio));
  document.getElementById('ppFoodAustin').textContent = '$' + formatWithCommas(AUSTIN_COSTS.grocery);
  document.getElementById('ppUtilOrigin').textContent = '$' + formatWithCommas(Math.round(AUSTIN_COSTS.utilities * utilRatio));
  document.getElementById('ppUtilAustin').textContent = '$' + formatWithCommas(AUSTIN_COSTS.utilities);

  // Category breakdown bars
  const categories = [
    { name: 'Housing', cityVal: city.housing, austinVal: AUSTIN.housing },
    { name: 'Grocery', cityVal: city.grocery, austinVal: AUSTIN.grocery },
    { name: 'Utilities', cityVal: city.utilities, austinVal: AUSTIN.utilities },
    { name: 'Transport', cityVal: city.transport, austinVal: AUSTIN.transport },
    { name: 'Healthcare', cityVal: city.healthcare, austinVal: AUSTIN.healthcare },
  ];

  const barsEl = document.getElementById('colCategoryBars');
  let barsHTML = '';
  categories.forEach(cat => {
    const diff = ((cat.cityVal - cat.austinVal) / cat.cityVal * 100);
    const isGood = diff > 0; // Austin is cheaper
    const barWidth = Math.min(48, Math.abs(diff) * 0.8);
    const pctText = isGood ? `-${Math.abs(diff).toFixed(0)}%` : `+${Math.abs(diff).toFixed(0)}%`;

    let barStyle;
    if (isGood) {
      barStyle = `right: 50%; width: ${barWidth}%;`;
    } else {
      barStyle = `left: 50%; width: ${barWidth}%;`;
    }

    barsHTML += `
      <div class="col-category-row">
        <div class="col-cat-label">${cat.name}</div>
        <div class="col-cat-bar-area">
          <div class="col-cat-bar-track">
            <div class="baseline"></div>
            <div class="col-cat-bar-fill ${isGood ? 'cheaper' : 'pricier'}" style="${barStyle}"></div>
          </div>
          <div class="col-cat-pct ${isGood ? 'cheaper' : 'pricier'}">${pctText}</div>
        </div>
      </div>
    `;
  });
  barsEl.innerHTML = barsHTML;

  // Tax savings
  const taxCard = document.getElementById('colTaxCard');
  if (city.stateIncomeTax > 0) {
    taxCard.style.display = '';
    const taxSavings = Math.round(colState.salary * (city.stateIncomeTax / 100));
    const stateName = city.name.split(', ')[1] || '';
    const stateNames = { CA: 'California', NY: 'New York', MA: 'Massachusetts', DC: 'Washington DC', CO: 'Colorado', IL: 'Illinois', OR: 'Oregon', MN: 'Minnesota', GA: 'Georgia', NC: 'North Carolina', UT: 'Utah', PA: 'Pennsylvania', MI: 'Michigan', AZ: 'Arizona', OH: 'Ohio', IN: 'Indiana', MO: 'Missouri', MD: 'Maryland' };
    const fullState = stateNames[stateName] || stateName;
    document.getElementById('colTaxSavingsText').innerHTML =
      `Moving from ${fullState} (${city.stateIncomeTax}% top rate), you could save an estimated <strong>$${formatWithCommas(taxSavings)}</strong> per year on state income taxes alone on a $${formatWithCommas(colState.salary)} salary.`;
  } else {
    taxCard.style.display = 'none';
  }
}

// Close dropdown on outside click
document.addEventListener('click', function(e) {
  const dd = document.getElementById('colCityDropdown');
  const search = document.getElementById('colCitySearch');
  if (!dd.contains(e.target) && e.target !== search) {
    dd.classList.remove('open');
  }
});

// ═══════════════════════════════════════════════════════════
// INIT
// ═══════════════════════════════════════════════════════════
document.addEventListener('DOMContentLoaded', () => {
  renderVestingBar();
  recalculate();
});
</script>
</body>
</html>
